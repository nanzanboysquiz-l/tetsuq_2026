<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>n分デジタルタイマー</title>
  <style>
    body { font-family: system-ui, sans-serif; background:#f7f7f7; padding:24px; }
    .wrap { max-width: 420px; margin: 0 auto; background:#fff; border:1px solid #ddd; border-radius:10px; padding:20px; }
    .row { display:flex; gap:10px; align-items:center; margin-bottom:14px; }
    input[type="number"] { width:120px; padding:8px; font-size:16px; }
    button { padding:8px 12px; font-size:16px; }
    .time { font-variant-numeric: tabular-nums; font-size:48px; text-align:center; margin:18px 0; }
    .status { text-align:center; color:#555; min-height:1.5em; }
    .warn { color:#b00020; }
    .ok { color:#2e7d32; }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>n分デジタルタイマー</h2>

    <div class="row">
      <label for="minutes"><b>分数 n:</b></label>
      <input id="minutes" type="number" min="1" step="1" placeholder="例: 5" />
      <button id="setBtn">設定</button>
    </div>

    <div class="time" id="display">00:00</div>
    <div class="row" style="justify-content:center;">
      <button id="startBtn">開始</button>
      <button id="pauseBtn" disabled>一時停止</button>
      <button id="resetBtn" disabled>リセット</button>
    </div>

    <div class="status" id="status"></div>
  </div>

  <script>
    const minutesInput = document.getElementById('minutes');
    const setBtn       = document.getElementById('setBtn');
    const startBtn     = document.getElementById('startBtn');
    const pauseBtn     = document.getElementById('pauseBtn');
    const resetBtn     = document.getElementById('resetBtn');
    const display      = document.getElementById('display');
    const status       = document.getElementById('status');

    let totalSeconds = 0;    // 設定された総秒数（n分）
    let remaining    = 0;    // 残り秒数
    let timerId      = null; // setInterval のID
    let running      = false;

    function format(sec) {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      const mm = String(m).padStart(2, '0');
      const ss = String(s).padStart(2, '0');
      return `${mm}:${ss}`;
    }

    function setStatus(msg, ok=false) {
      status.textContent = msg || '';
      status.className = 'status ' + (msg ? (ok ? 'ok' : 'warn') : '');
    }

    function updateDisplay() {
      display.textContent = format(remaining);
    }

    function validateN(value) {
      // 自然数（1,2,3, ...）か検証
      const n = Number(value);
      if (!Number.isInteger(n) || n < 1) return null;
      return n;
    }

    function setMinutes() {
      const n = validateN(minutesInput.value);
      if (n === null) {
        setStatus('n は 1 以上の自然数を入力してください。');
        return;
      }
      totalSeconds = n * 60;
      remaining = totalSeconds;
      updateDisplay();
      setStatus(`n=${n} 分で設定しました。`, true);
      startBtn.disabled = false;
      resetBtn.disabled = false;
      pauseBtn.disabled = true;
    }

    function tick() {
      if (remaining > 0) {
        remaining -= 1;
        updateDisplay();
        if (remaining === 0) {
          clearInterval(timerId);
          timerId = null;
          running = false;
          setStatus('タイマー終了。', true);
          startBtn.disabled = false;
          pauseBtn.disabled = true;
        }
      }
    }

    function startTimer() {
      if (running) return;
      if (remaining <= 0) {
        // 未設定や0秒なら設定を促す
        if (totalSeconds > 0) {
          remaining = totalSeconds; // 終了後の再開始は再設定秒から
        } else {
          setStatus('まず n を設定してください。');
          return;
        }
      }
      timerId = setInterval(tick, 1000);
      running = true;
      startBtn.disabled = true;
      pauseBtn.disabled = false;
      setStatus('カウント中…', true);
    }

    function pauseTimer() {
      if (!running) return;
      clearInterval(timerId);
      timerId = null;
      running = false;
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      setStatus('一時停止中。', true);
    }

    function resetTimer() {
      if (running) {
        clearInterval(timerId);
        timerId = null;
        running = false;
      }
      remaining = totalSeconds || 0;
      updateDisplay();
      startBtn.disabled = totalSeconds === 0;
      pauseBtn.disabled = true;
      resetBtn.disabled = totalSeconds === 0;
      setStatus(totalSeconds ? 'リセットしました。' : 'まず n を設定してください。', !!totalSeconds);
    }

    setBtn.addEventListener('click', setMinutes);
    startBtn.addEventListener('click', startTimer);
    pauseBtn.addEventListener('click', pauseTimer);
    resetBtn.addEventListener('click', resetTimer);

    // Enterキーで設定
    minutesInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') setMinutes();
    });

    // 初期表示
    updateDisplay();
  </script>
</body>
</html>
