<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ターンオーバー</title>
  <style>
  .outer {
  width: 500px; 
  height: calc(500px * 529 / 1134); /* 画像比率に合わせる */
  position: relative;
  margin-bottom: 10px;
}

.flap {
  width: 100%;
  height: 100%;
  position: absolute;
  overflow: hidden;
}

.flap img {
  width: 100%;
  height: 100%;
  object-fit: contain;  /* ← 比率維持で縮小して収める */
  display: block;
}

/* 上半分・下半分の切り取り */
.flap.top {
  clip-path: polygon(0 0, 100% 0, 100% 50%, 0 50%);
  display: none;
}

.flap.bottom {
  clip-path: polygon(0 50%, 100% 50%, 100% 100%, 0 100%);
  display: none;
}

.gap {
  height: 1px;
  width: 100%;
  position: relative;
  top: 50%;
  background-color: #000;
  opacity: 0.6;
}
  </style>
</head>
<body>
<div class="outer">
  <div class="flap" id="flap">
    <img id="flapImg" />
  </div>
  <div class="flap top">
    <img id="flapImgTop" />
  </div>
  <div class="flap bottom">
    <img id="flapImgBottom" />
  </div>
  <div class="gap"></div>
</div>

<button onclick="start()">Start</button>
<button onclick="slow()">Slow</button>

  <script>
function start() {
  turn(60);
}

function slow() {
  turn(300);
}

async function turn(duration) {
  for (let n = 1; n <= 10; n++) {
    await turnFlap(n, duration);
  }
}

async function turnFlap(n, duration) {

  const flap  = document.querySelector('#flap');
  const flapT = document.querySelector('.flap.top');
  const flapB = document.querySelector('.flap.bottom');

  const imgMain = document.querySelector('#flapImg');
  const imgTop  = document.querySelector('#flapImgTop');
  const imgBot  = document.querySelector('#flapImgBottom');

  const imgPath = `assets/images/to/TO${n}.png`;

  // 画像セット
  imgMain.src = imgPath;
  imgTop.src  = imgPath;
  imgBot.src  = imgPath;

  flap.style.zIndex = 11;
  flapB.style.zIndex = 12;
  flapT.style.zIndex = 10;

  flapT.style.display = 'block';
  flapB.style.display = 'block';

  // 前半90度回転
  let animation = flap.animate(
    [{ transform: 'rotateX(-90deg)' }],
    { duration: duration }
  );
  await animation.finished;

  // 後半設定
  flap.style.transform = 'rotateX(90deg)';
  flap.style.zIndex = 11;
  flapB.style.zIndex = 10;
  flapT.style.zIndex = 12;

  // 後半90度回転
  animation = flap.animate(
    [{ transform: 'rotateX(0deg)' }],
    { duration: duration, fill: 'forwards' }
  );
  await animation.finished;
  animation.commitStyles();
  animation.cancel();

  flapB.style.display = 'none';
  flapT.style.display = 'none';
}
  </script>
</body>
</html>
