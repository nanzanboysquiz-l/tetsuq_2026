<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>方向幕 スクロール（1周分のみ配置）</title>
  <style>
    .container {
      width: 1134px;
      height: 529px;
      overflow: hidden;
      border: 2px solid #333;
      position: relative;
    }
    .track {
      display: flex;
      flex-direction: column;
      transform: translateY(0);
    }
    .track img {
      width: 1134px;
      height: 529px;
    }
    .buttons {
      margin-top: 10px;
    }
    .buttons button {
      margin: 5px;
      padding: 8px 16px;
    }
  </style>
</head>
<body>
  <h2>方向幕 スクロール（1周分のみ配置）</h2>
  <div class="container">
    <div class="track" id="track">
      <!-- 先頭に特殊3枚 -->
      <img src="assets/images/to/TOOiS.png">
      <img src="assets/images/to/TOOiS.png">
      <img src="assets/images/to/TOWhite.png">
      <!-- 通常方向幕 -->
      <img src="assets/images/to/TO1.png">
      <img src="assets/images/to/TO2.png">
      <img src="assets/images/to/TO3.png">
      <!-- 最後尾にホワイト -->
      <img src="assets/images/to/TOWhite.png">
    </div>
  </div>

  <div>
    <label>停止番号リスト (最大4): <input type="text" id="stopList" value="7,3,2"></label>
    <button onclick="generateButtons()">▶ ボタン生成</button>
  </div>

  <div class="buttons" id="buttons"></div>

  <script>
    const track = document.getElementById("track");
    const imageHeight = 529;
    const totalImages = 7; // 合計7枚
    let scrollTimer = null;
    let currentIndex = 1; // 現在位置（1始まり）
    let offsetY = 0;      // 累積スクロール位置

    // 指定番号までスクロール
    function scrollTo(stopIndex) {
      if (scrollTimer) clearInterval(scrollTimer);

      let distance;
      let direction;

      if (stopIndex > currentIndex) {
        // 老いている → 前方向(+移動)
        distance = stopIndex - currentIndex;
        direction = -1;
      } else if (stopIndex < currentIndex) {
        // 若い → 一度最後尾+1枚目まで進んでから逆方向(-移動)
        distance = (totalImages - currentIndex) + 1; 
        direction = -1; // まず前方向に進む
        // 終了後に逆方向へ再スクロール
        setTimeout(() => {
          scrollBackward(stopIndex);
        }, distance * 30); // 速度に応じて調整
        return;
      } else {
        return; // 同じ番号なら何もしない
      }

      let steps = distance * imageHeight;
      let moved = 0;

      scrollTimer = setInterval(() => {
        moved += Math.abs(direction * 10);
        offsetY += direction * 10;

        track.style.transform = `translateY(${offsetY}px)`;

        if (moved >= steps) {
          clearInterval(scrollTimer);
          scrollTimer = null;
          currentIndex = stopIndex;
        }
      }, 16);
    }

    // 逆方向スクロール
    function scrollBackward(stopIndex) {
      if (scrollTimer) clearInterval(scrollTimer);

      let distance = stopIndex - 1; // 先頭から目的地まで戻る
      let steps = distance * imageHeight;
      let moved = 0;
      let direction = +1; // 下方向（逆スクロール）

      scrollTimer = setInterval(() => {
        moved += Math.abs(direction * 10);
        offsetY += direction * 10;

        track.style.transform = `translateY(${offsetY}px)`;

        if (moved >= steps) {
          clearInterval(scrollTimer);
          scrollTimer = null;
          currentIndex = stopIndex;
        }
      }, 16);
    }

    // 順序ラベル生成
    function ordinal(n) {
      const suffixes = ["th","st","nd","rd"];
      const v = n % 100;
      return n + (suffixes[(v-20)%10] || suffixes[v] || suffixes[0]);
    }

    // ボタン生成
    function generateButtons() {
      const input = document.getElementById("stopList").value;
      const numbers = input.split(",").map(n => parseInt(n.trim(), 10)).filter(n => !isNaN(n));
      const buttonsDiv = document.getElementById("buttons");
      buttonsDiv.innerHTML = "";

      numbers.slice(0,4).forEach((num, idx) => {
        const btn = document.createElement("button");
        btn.textContent = `${ordinal(idx+1)} → Stop at ${num}`;
        btn.onclick = () => scrollTo(num);
        buttonsDiv.appendChild(btn);
      });
    }
  </script>
</body>
</html>
